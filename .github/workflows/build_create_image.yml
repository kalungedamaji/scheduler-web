name: TestAndBuild
on:
    push:
      branches: [ master ]
    pull_request:
      branches: [ master ]
jobs:
    testAndBuild:
      name: Test And Build Docker Iamge
      runs-on: ubuntu-latest
      steps:
       - uses: actions/checkout@v2
        # Setup .npmrc file to publish to npm
       - uses: actions/setup-node@v2
         with:
            node-version: '16.x'
            registry-url: 'https://registry.npmjs.org'
       - name: clean install
         run: npm ci
       - name: build
         run: npm run build

       - name: Log in to Docker Hub
         run: |
              docker login -u dkalunge -p Discover#1137

       - name: build docker Image
           run: |
             docker build  -t  scheduler-web  .

       - name: Extract metadata (tags, labels) for Docker
         id: meta
         uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38
         with:
           images: my-docker-hub-namespace/my-docker-hub-repository

       - name: Build and push Docker image
         uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
         with:
             context: .
             push: true
             tags: ${{ steps.meta.outputs.tags }}
             labels: ${{ steps.meta.outputs.labels }}
      outputs:
        image_name: scheduler-web

